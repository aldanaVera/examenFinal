<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>APL</title>
    <link rel="stylesheet" href="estilos.css" />
    <link
      href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@300;400;700&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://unpkg.com/boxicons@2.0.5/css/boxicons.min.css"
      rel="stylesheet"
    />
    <meta
      name="viewport"
      content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0"
    />
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css"
      integrity="sha384-9gVQ4dYFwwWSjIDZnLEWnxCjeSWFphJiwGPXr1jddIhOegiu1FwO5qRGvFXOdJZ4"
      crossorigin="anonymous"
    />
  </head>
  <body>
    <div id="login">
        <form id="loginform">
            <div class="user">
            <label for="usuario"><h1>Login</h1></label>
        </div>
            <input name="nombre" id="nombre" type="text" placeholder="Escribe tu nombre" required>
            <label id="res"></label>
            <button type="submit" title="Ingresar"  onclick="validar()">Iniciar Sesion</button>
        </form>
        
    </div>
    <br>
    <div>
    <section class="gallery" id="galeria">
      <div class="contenedor">
        <h2 class="subtitulo"></h2>
        <div class="contenedor-galeria">
          <img src="img/uno.jpg" class="img-galeria" alt="Hola" />
          <img src="img/dos.jpg" class="img-galeria" alt="" />
          <img src="img/tres.jpg" class="img-galeria" alt="" />
          <img src="img/cuatro.jpg" class="img-galeria" alt="" />
          <img src="img/cinco.jpg" class="img-galeria" alt="" />
        </div>
    </div>
      </div>
   
    <section class="services contenedor" id="servicio">
      <div class="contenedor-servicio">
        <img src="img/logo3.jpg" alt="" />
        <div class="checklist-servicio">
          <div class="service">
            <h3 class="n-service"><span class="number"></span>Visión</h3>
            <p>
              Prestación de servicios especializados al sector productivo
              lechero como agente de cambio y compromiso, manteniendo la
              viabilidad y autosuficiencia de la institución y reconocimiento a
              nivel departamental y nacional.
            </p>
          </div>
          <div class="service">
            <h3 class="n-service"><span class="number"></span>Misión</h3>
            <p>
              Somos una institución sin fines de lucro con vocación de servicio
              a sus asociados y a todo el sector productivo lechero, su campo de
              acción comprende toda la cuenca lechera del departamento de
              Cochabamba, ofreciendo servicios de calidad y alto nivel de
              competitividad y compromiso a través del conocimiento científico y
              tecnológico.
            </p>
          </div>
        </div>
      </div>
    </section>
    <header class="header" id="inicio">
      <img class="hamburguer" src="img/hamburguesa.svg" alt="" />
      <nav class="menu-navegacion">
        <a href="#inicio">Inicio</a>
        <a href="#servicio">Nosotros</a>
        <a href="#galeria">Portafolio</a>
        <a href="#expertos">Especializados</a>
        <a href="#footer">Nuestros productos</a>
      </nav>
      <div class="contenedor head">
        <h1 class="titulo">Asociación de Productores de Leche</h1>
        <p class="copy">Valle de Cochabamba</p>
      </div>
    </header>
    <main>
      <div class="imagen-light">
        <img src="img/close.svg" alt="" class="close" />
        <img src="" alt="" class="agregar-imagen" />
      </div>
      <section class="contenedor" id="expertos">
        <h2 class="subtitulo">Nuestros Servicicos:</h2>
        <section class="experts">
          <div class="cont-expert">
            <img src="img/logo5.jpg" alt="" />
            <h3 class="n-expert">Inseminacion Artificial</h3>
          </div>
          <div class="cont-expert">
            <img src="img/logo7.jpg" alt="" />
            <h3 class="n-expert">Maquinaria</h3>
          </div>
          <div class="cont-expert">
            <img src="img/logo8.jpg" alt="" />
            <h3 class="n-expert">Capacitaciones</h3>
          </div>
        </section>
      </section>
      <br />
      
      <h2 class="subtitulo">Nuestros Productos:</h2>
    </main>
    <div class="container">
      <div class="row">
        <!-- Elementos generados a partir del JSON -->
        <main id="items" class="col-sm-8 row"></main>
        <!-- Carrito -->
        <aside class="col-sm-4">
          <h2>Carrito</h2>
          <!-- Elementos del carrito -->
          <ul id="carrito" class="list-group"></ul>
          <hr />
          <!-- Precio total -->
          <p class="text-right">Total: <span id="total"></span> Bs.</p>
          <button id="boton-vaciar" class="btn btn-danger">Vaciar</button>
          <button type="submit" title="Ingresar" class="btn" onclick="validar2()">
            validar compra
          </button>
        </aside>
      </div>
    </div>
    <footer id="footer">
      <div class="contenedor footer-content">
        <div class="contact-us">
          <h2 class="brand">APL</h2>
          <p>Asociación de Productores de Leche del Valle de Cochabamba</p>
        </div>
        <div class="social-media">
          <a href="./" class="social-media-icon">
            <i class="bx bxl-facebook"></i>
          </a>
          <a href="./" class="social-media-icon">
            <i class="bx bxl-twitter"></i>
          </a>
          <a href="./" class="social-media-icon">
            <i class="bx bxl-instagram"></i>
          </a>
          <a href="./" class="social-media-icon">
            <i class="bx bxl-whatsapp"></i>
          </a>
        </div>
      </div>

      <div class="line"></div>
    </footer>
    <script src="js/menu.js"></script>
    <script src="js/lightbox.js"></script>
    <script type="text/javascript">
        function validar() {
        var nombre = document.getElementById("nombre").value;
        alert("Bienvenido: " + nombre);
      }
      function validar2() {
        var nombre = document.getElementById("nombre").value;
        alert("compra realizada");
      }
    </script>
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        // Variables
        const baseDeDatos = [
          {
            id: 1,
            nombre: "vacunas",
            precio: 25,
            imagen: "img/vacuna.jpg",
          },
          {
            id: 2,
            nombre: "Alimento",
            precio: 150,
            imagen: "img/alimento.jpg",
          },
          {
            id: 3,
            nombre: "Insumos",
            precio: 80,
            imagen: "img/insumos.jpg",
          },
          {
            id: 4,
            nombre: "Herramientas",
            precio: 250,
            imagen: "img/herramienta.jpg",
          },
        ];

        let carrito = [];
        const divisa = "Bs.";
        const DOMitems = document.querySelector("#items");
        const DOMcarrito = document.querySelector("#carrito");
        const DOMtotal = document.querySelector("#total");
        const DOMbotonVaciar = document.querySelector("#boton-vaciar");

        // Funciones

        /**
         * Dibuja todos los productos a partir de la base de datos. No confundir con el carrito
         */
        function renderizarProductos() {
          baseDeDatos.forEach((info) => {
            // Estructura
            const miNodo = document.createElement("div");
            miNodo.classList.add("card", "col-sm-4");
            // Body
            const miNodoCardBody = document.createElement("div");
            miNodoCardBody.classList.add("card-body");
            // Titulo
            const miNodoTitle = document.createElement("h5");
            miNodoTitle.classList.add("card-title");
            miNodoTitle.textContent = info.nombre;
            // Imagen
            const miNodoImagen = document.createElement("img");
            miNodoImagen.classList.add("img-fluid");
            miNodoImagen.setAttribute("src", info.imagen);
            // Precio
            const miNodoPrecio = document.createElement("p");
            miNodoPrecio.classList.add("card-text");
            miNodoPrecio.textContent = `${info.precio}${divisa}`;
            // Boton
            const miNodoBoton = document.createElement("button");
            miNodoBoton.classList.add("btn", "btn-primary");
            miNodoBoton.textContent = "+";
            miNodoBoton.setAttribute("marcador", info.id);
            miNodoBoton.addEventListener("click", anyadirProductoAlCarrito);
            // Insertamos
            miNodoCardBody.appendChild(miNodoImagen);
            miNodoCardBody.appendChild(miNodoTitle);
            miNodoCardBody.appendChild(miNodoPrecio);
            miNodoCardBody.appendChild(miNodoBoton);
            miNodo.appendChild(miNodoCardBody);
            DOMitems.appendChild(miNodo);
          });
        }

        /**
         * Evento para añadir un producto al carrito de la compra
         */
        function anyadirProductoAlCarrito(evento) {
          // Anyadimos el Nodo a nuestro carrito
          carrito.push(evento.target.getAttribute("marcador"));
          // Actualizamos el carrito
          renderizarCarrito();
        }

        /**
         * Dibuja todos los productos guardados en el carrito
         */
        function renderizarCarrito() {
          // Vaciamos todo el html
          DOMcarrito.textContent = "";
          // Quitamos los duplicados
          const carritoSinDuplicados = [...new Set(carrito)];
          // Generamos los Nodos a partir de carrito
          carritoSinDuplicados.forEach((item) => {
            // Obtenemos el item que necesitamos de la variable base de datos
            const miItem = baseDeDatos.filter((itemBaseDatos) => {
              // ¿Coincide las id? Solo puede existir un caso
              return itemBaseDatos.id === parseInt(item);
            });
            // Cuenta el número de veces que se repite el producto
            const numeroUnidadesItem = carrito.reduce((total, itemId) => {
              // ¿Coincide las id? Incremento el contador, en caso contrario no mantengo
              return itemId === item ? (total += 1) : total;
            }, 0);
            // Creamos el nodo del item del carrito
            const miNodo = document.createElement("li");
            miNodo.classList.add("list-group-item", "text-right", "mx-2");
            miNodo.textContent = `${numeroUnidadesItem} x ${miItem[0].nombre} - ${miItem[0].precio}${divisa}`;
            // Boton de borrar
            const miBoton = document.createElement("button");
            miBoton.classList.add("btn", "btn-danger", "mx-5");
            miBoton.textContent = "X";
            miBoton.style.marginLeft = "1rem";
            miBoton.dataset.item = item;
            miBoton.addEventListener("click", borrarItemCarrito);
            // Mezclamos nodos
            miNodo.appendChild(miBoton);
            DOMcarrito.appendChild(miNodo);
          });
          // Renderizamos el precio total en el HTML
          DOMtotal.textContent = calcularTotal();
        }

        /**
         * Evento para borrar un elemento del carrito
         */
        function borrarItemCarrito(evento) {
          // Obtenemos el producto ID que hay en el boton pulsado
          const id = evento.target.dataset.item;
          // Borramos todos los productos
          carrito = carrito.filter((carritoId) => {
            return carritoId !== id;
          });
          // volvemos a renderizar
          renderizarCarrito();
        }

        /**
         * Calcula el precio total teniendo en cuenta los productos repetidos
         */
        function calcularTotal() {
          // Recorremos el array del carrito
          return carrito
            .reduce((total, item) => {
              // De cada elemento obtenemos su precio
              const miItem = baseDeDatos.filter((itemBaseDatos) => {
                return itemBaseDatos.id === parseInt(item);
              });
              // Los sumamos al total
              return total + miItem[0].precio;
            }, 0)
            .toFixed(2);
        }

        /**
         * Varia el carrito y vuelve a dibujarlo
         */
        function vaciarCarrito() {
          // Limpiamos los productos guardados
          carrito = [];
          // Renderizamos los cambios
          renderizarCarrito();
        }

        // Eventos
        DOMbotonVaciar.addEventListener("click", vaciarCarrito);

        // Inicio
        renderizarProductos();
        renderizarCarrito();
      });
    </script>
  </body>
</html>
